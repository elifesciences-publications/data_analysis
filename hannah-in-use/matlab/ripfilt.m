function y = ripfilt(x)

% RIPFILT Filters input x and returns output y.
% hilbert transforms output
% filters in ripple frequency range 100-300. import eeg data from gh_debuffer
% example:
% data = ripfilt(lfp.data);



persistent Hd;

if isempty(Hd)

    % The following code was used to design the filter coefficients:
    % % FIR Window Bandpass filter designed using the FIR1 function.
    %
    % % All frequency values are in Hz.
    % Fs = 2000;  % Sampling Frequency
    %
    % N    = 500;      % Order
    % Fc1  = 100;      % First Cutoff Frequency
    % Fc2  = 300;      % Second Cutoff Frequency
    % flag = 'scale';  % Sampling Flag
    % % Create the window vector for the design algorithm.
    % win = blackman(N+1);
    %
    % % Calculate the coefficients using the FIR1 function.
    % b  = fir1(N, [Fc1 Fc2]/(Fs/2), 'bandpass', win, flag);

    Hd = dsp.FIRFilter( ...
        'Numerator', [0 9.08466204519207e-09 2.65125651172904e-08 ...
        -8.24615861104705e-08 -4.53198082864083e-07 -9.24560822169642e-07 ...
        -1.02922336403576e-06 -4.57386275680861e-07 4.36202306692104e-07 ...
        7.63743759051614e-07 -1.11433568121836e-20 -1.15304415058751e-06 ...
        -1.0024569553866e-06 1.62841550668213e-06 5.8458707808923e-06 ...
        8.77316467592616e-06 7.72637552035163e-06 2.85141817531312e-06 ...
        -2.33707636542179e-06 -3.60686535172413e-06 -1.1842498304715e-20 ...
        4.46403108127431e-06 3.5834711110594e-06 -5.42765074699121e-06 ...
        -1.83151547551926e-05 -2.60112153929799e-05 -2.1801967178501e-05 ...
        -7.69492079177109e-06 6.05692005410863e-06 9.00978936061149e-06 ...
        1.71422286607328e-19 -1.04535608664235e-05 -8.15602717907313e-06 ...
        1.20327559928879e-05 3.96260295924794e-05 5.50170813613062e-05 ...
        4.51516361829754e-05 1.5625379684185e-05 -1.20747091335965e-05 ...
        -1.76537449626607e-05 -7.34908208215517e-20 1.98474170115669e-05 ...
        1.5263835112804e-05 -2.22148410674594e-05 -7.22223318912121e-05 ...
        -9.90594442525571e-05 -8.03620667032198e-05 -2.75067237429296e-05 ...
        2.10352928853719e-05 3.04500826285553e-05 -1.22302155926781e-18 ...
        -3.360500187013e-05 -2.56215621244143e-05 3.69819600206013e-05 ...
        0.000119282065438117 0.000162367415104537 0.000130763608591696 ...
        4.44460017292411e-05 -3.37612138741526e-05 -4.85561481861269e-05 ...
        1.19263013427549e-18 5.29344671046814e-05 4.01255736286334e-05 ...
        -5.75935662148126e-05 -0.000184760938262711 -0.000250185965554249 ...
        -0.000200472108311939 -6.78067313333887e-05 5.12622483985272e-05 ...
        7.33882226887467e-05 -1.75715037510648e-18 -7.93053556129922e-05 ...
        -5.98630430092018e-05 8.55729799553584e-05 0.000273430621120641 ...
        0.00036882564846434 0.000294427278653377 9.92214427066166e-05 ...
        -7.47446055539912e-05 -0.00010663434513172 2.49039127388902e-18 ...
        0.000114461885226024 8.61218236360012e-05 -0.000122721332089082 ...
        -0.00039092292405232 -0.000525721881104398 -0.000418439931934797 ...
        -0.00014060761351522 0.000105622978885343 0.000150271620138088 ...
        -1.21714015387464e-18 -0.000160441910427405 -0.00012040490849735 ...
        0.000171138486104084 0.000543797584034234 0.000729527808791313 ...
        0.000579267373901116 0.000194193541568055 -0.000145540415154091 ...
        -0.000206595142368281 -1.46197969216023e-18 0.000219609328776103 ...
        0.000164455365625159 -0.000233259395343149 -0.00073966082188543 ...
        -0.00099027758142471 -0.000784746532496943 -0.000262564183640722 ...
        0.000196403605208169 0.000278269464285198 2.10582786369292e-18 ...
        -0.000294711843814869 -0.000220300787803529 0.000311918890403482 ...
        0.000987376455288012 0.00131967679910791 0.00104403046954802 ...
        0.000348742468538243 -0.00026044538107876 -0.000368419575727716 ...
        7.79097575261377e-18 0.000388982673531461 0.000290331399485106 ...
        -0.000410465288159342 -0.00129743533303413 -0.00173160972817236 ...
        -0.00136800057311643 -0.000456330728648555 0.000340333210913421 ...
        0.000480788551364498 -2.90044981235792e-18 -0.000506316178121557 ...
        -0.000377434714815957 0.000532955963617095 0.00168259041460748 ...
        0.00224301012511404 0.00176997341947592 0.000589752987394035 ...
        -0.000439354893088573 -0.000620007160186602 -5.60770628336622e-18 ...
        0.000651567867008329 0.000485225471480895 -0.000684491213304134 ...
        -0.00215894080303057 -0.00287534771017736 -0.00226690757299619 ...
        -0.000754668736972874 0.00056173582848078 0.000792054789782302 ...
        -1.55045083423144e-17 -0.000831068130227763 -0.000618439777642791 ...
        0.000871787234261883 0.00274779465278824 0.00365718645818229 ...
        0.00288148393801355 0.000958687505207666 -0.000713187989415626 ...
        -0.00100505863854599 1.1848295660487e-17 0.00105351712805042 ...
        0.000783623444072494 -0.00110417947476833 -0.00347894067625441 ...
        -0.00462869086893148 -0.00364578183273139 -0.001212635749068 ...
        0.000901886628613137 0.00127072083314394 -5.097659144504e-18 ...
        -0.00133159534700079 -0.000990375962224299 0.00139544380146834 ...
        0.0043966130290848 0.00584988073340645 0.00460804576703634 ...
        0.00153290068419809 -0.0011402867087115 -0.00160698689113523 ...
        -6.04949657830955e-18 0.00168500953338405 0.00125371727119304 ...
        -0.00176728290040803 -0.00557098349956391 -0.00741664030478082 ...
        -0.0058458984500364 -0.00194603917087082 0.00144872068941479 ...
        0.00204337077836147 -6.15528625848387e-18 -0.00214666695085802 ...
        -0.00159892480781502 0.00225651206243748 0.00712205535138808 ...
        0.00949430417010449 0.00749431876064977 0.00249863060499949 ...
        -0.00186316613674946 -0.00263256929504259 2.58282142216225e-17 ...
        0.00277643244434565 0.00207243239524351 -0.00293143849647044 ...
        -0.00927478132035022 -0.0123960947359649 -0.00981182141245841 ...
        -0.00328089277635629 0.00245411950288389 0.00347908467847523 ...
        -7.02467355646252e-18 -0.00369605821081208 -0.00276994230577223 ...
        0.0039348057069731 0.0125060506403481 0.0167960222220984 ...
        0.0133634154400154 0.00449323020756246 -0.0033808522994877 ...
        -0.00482323469880425 7.35357280539088e-18 0.00519636455499706 ...
        0.00392476216731522 -0.0056221449828036 -0.0180307879204721 ...
        -0.0244526114629251 -0.0196608418697302 -0.00668634370698745 ...
        0.00509360326009873 0.00736513681688674 -7.59674429550864e-18 ...
        -0.00818281745098294 -0.00629054241036807 0.00918834044622935 ...
        0.0301106277343967 0.0418271070118218 0.0345463173912478 ...
        0.0121094029039181 -0.00954662076099593 -0.0143557062490093 ...
        7.7460281556395e-18 0.0175913971461833 0.0143943537126601 ...
        -0.0226644420205207 -0.0814481900641225 -0.127118302886347 ...
        -0.122330618855756 -0.0530208632369092 0.0578015776186219 ...
        0.15914500174515 0.200000455915842 0.15914500174515 0.0578015776186219 ...
        -0.0530208632369092 -0.122330618855756 -0.127118302886347 ...
        -0.0814481900641225 -0.0226644420205207 0.0143943537126601 ...
        0.0175913971461833 7.7460281556395e-18 -0.0143557062490093 ...
        -0.00954662076099593 0.0121094029039181 0.0345463173912478 ...
        0.0418271070118218 0.0301106277343967 0.00918834044622935 ...
        -0.00629054241036807 -0.00818281745098294 -7.59674429550864e-18 ...
        0.00736513681688674 0.00509360326009873 -0.00668634370698745 ...
        -0.0196608418697302 -0.0244526114629251 -0.0180307879204721 ...
        -0.0056221449828036 0.00392476216731522 0.00519636455499706 ...
        7.35357280539088e-18 -0.00482323469880425 -0.0033808522994877 ...
        0.00449323020756246 0.0133634154400154 0.0167960222220984 ...
        0.0125060506403481 0.0039348057069731 -0.00276994230577223 ...
        -0.00369605821081208 -7.02467355646252e-18 0.00347908467847523 ...
        0.00245411950288389 -0.00328089277635629 -0.00981182141245841 ...
        -0.0123960947359649 -0.00927478132035022 -0.00293143849647044 ...
        0.00207243239524351 0.00277643244434565 2.58282142216225e-17 ...
        -0.00263256929504259 -0.00186316613674946 0.00249863060499949 ...
        0.00749431876064977 0.00949430417010449 0.00712205535138808 ...
        0.00225651206243748 -0.00159892480781502 -0.00214666695085802 ...
        -6.15528625848387e-18 0.00204337077836147 0.00144872068941479 ...
        -0.00194603917087082 -0.0058458984500364 -0.00741664030478082 ...
        -0.00557098349956391 -0.00176728290040803 0.00125371727119304 ...
        0.00168500953338405 -6.04949657830955e-18 -0.00160698689113523 ...
        -0.0011402867087115 0.00153290068419809 0.00460804576703634 ...
        0.00584988073340645 0.0043966130290848 0.00139544380146834 ...
        -0.000990375962224299 -0.00133159534700079 -5.097659144504e-18 ...
        0.00127072083314394 0.000901886628613137 -0.001212635749068 ...
        -0.00364578183273139 -0.00462869086893148 -0.00347894067625441 ...
        -0.00110417947476833 0.000783623444072494 0.00105351712805042 ...
        1.1848295660487e-17 -0.00100505863854599 -0.000713187989415626 ...
        0.000958687505207666 0.00288148393801355 0.00365718645818229 ...
        0.00274779465278824 0.000871787234261883 -0.000618439777642791 ...
        -0.000831068130227763 -1.55045083423144e-17 0.000792054789782302 ...
        0.00056173582848078 -0.000754668736972874 -0.00226690757299619 ...
        -0.00287534771017736 -0.00215894080303057 -0.000684491213304134 ...
        0.000485225471480895 0.000651567867008329 -5.60770628336622e-18 ...
        -0.000620007160186602 -0.000439354893088573 0.000589752987394035 ...
        0.00176997341947592 0.00224301012511404 0.00168259041460748 ...
        0.000532955963617095 -0.000377434714815957 -0.000506316178121557 ...
        -2.90044981235792e-18 0.000480788551364498 0.000340333210913421 ...
        -0.000456330728648555 -0.00136800057311643 -0.00173160972817236 ...
        -0.00129743533303413 -0.000410465288159342 0.000290331399485106 ...
        0.000388982673531461 7.79097575261377e-18 -0.000368419575727716 ...
        -0.00026044538107876 0.000348742468538243 0.00104403046954802 ...
        0.00131967679910791 0.000987376455288012 0.000311918890403482 ...
        -0.000220300787803529 -0.000294711843814869 2.10582786369292e-18 ...
        0.000278269464285198 0.000196403605208169 -0.000262564183640722 ...
        -0.000784746532496943 -0.00099027758142471 -0.00073966082188543 ...
        -0.000233259395343149 0.000164455365625159 0.000219609328776103 ...
        -1.46197969216023e-18 -0.000206595142368281 -0.000145540415154091 ...
        0.000194193541568055 0.000579267373901116 0.000729527808791313 ...
        0.000543797584034234 0.000171138486104084 -0.00012040490849735 ...
        -0.000160441910427405 -1.21714015387464e-18 0.000150271620138088 ...
        0.000105622978885343 -0.00014060761351522 -0.000418439931934797 ...
        -0.000525721881104398 -0.00039092292405232 -0.000122721332089082 ...
        8.61218236360012e-05 0.000114461885226024 2.49039127388902e-18 ...
        -0.00010663434513172 -7.47446055539912e-05 9.92214427066166e-05 ...
        0.000294427278653377 0.00036882564846434 0.000273430621120641 ...
        8.55729799553584e-05 -5.98630430092018e-05 -7.93053556129922e-05 ...
        -1.75715037510648e-18 7.33882226887467e-05 5.12622483985272e-05 ...
        -6.78067313333887e-05 -0.000200472108311939 -0.000250185965554249 ...
        -0.000184760938262711 -5.75935662148126e-05 4.01255736286334e-05 ...
        5.29344671046814e-05 1.19263013427549e-18 -4.85561481861269e-05 ...
        -3.37612138741526e-05 4.44460017292411e-05 0.000130763608591696 ...
        0.000162367415104537 0.000119282065438117 3.69819600206013e-05 ...
        -2.56215621244143e-05 -3.360500187013e-05 -1.22302155926781e-18 ...
        3.04500826285553e-05 2.10352928853719e-05 -2.75067237429296e-05 ...
        -8.03620667032198e-05 -9.90594442525571e-05 -7.22223318912121e-05 ...
        -2.22148410674594e-05 1.5263835112804e-05 1.98474170115669e-05 ...
        -7.34908208215517e-20 -1.76537449626607e-05 -1.20747091335965e-05 ...
        1.5625379684185e-05 4.51516361829754e-05 5.50170813613062e-05 ...
        3.96260295924794e-05 1.20327559928879e-05 -8.15602717907313e-06 ...
        -1.04535608664235e-05 1.71422286607328e-19 9.00978936061149e-06 ...
        6.05692005410863e-06 -7.69492079177109e-06 -2.1801967178501e-05 ...
        -2.60112153929799e-05 -1.83151547551926e-05 -5.42765074699121e-06 ...
        3.5834711110594e-06 4.46403108127431e-06 -1.1842498304715e-20 ...
        -3.60686535172413e-06 -2.33707636542179e-06 2.85141817531312e-06 ...
        7.72637552035163e-06 8.77316467592616e-06 5.8458707808923e-06 ...
        1.62841550668213e-06 -1.0024569553866e-06 -1.15304415058751e-06 ...
        -1.11433568121836e-20 7.63743759051614e-07 4.36202306692104e-07 ...
        -4.57386275680861e-07 -1.02922336403576e-06 -9.24560822169642e-07 ...
        -4.53198082864083e-07 -8.24615861104705e-08 2.65125651172904e-08 ...
        9.08466204519207e-09 0]);
end

d = step(Hd,x);
delay = mean(grpdelay(Hd));
d(1:delay) = [];
y = abs(hilbert(d));
y = d;


% [EOF]
