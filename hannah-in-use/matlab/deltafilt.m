function y = deltafilt(x)
%DELTAFILT Filters input x and returns output y.

% filters in theta frequency range 2-4. import eeg data from gh_debuffer
% example: 
% data = thetafilt(lfp.data);

persistent Hd;

if isempty(Hd)
    
    % The following code was used to design the filter coefficients:
    % % FIR Window Bandpass filter designed using the FIR1 function.
    %
    % % All frequency values are in Hz.
    % Fs = 2000;  % Sampling Frequency
    %
    % N    = 500;      % Order
    % Fc1  = 2;        % First Cutoff Frequency
    % Fc2  = 4;        % Second Cutoff Frequency
    % flag = 'scale';  % Sampling Flag
    % % Create the window vector for the design algorithm.
    % win = blackman(N+1);
    %
    % % Calculate the coefficients using the FIR1 function.
    % b  = fir1(N, [Fc1 Fc2]/(Fs/2), 'bandpass', win, flag);
    
    Hd = dsp.FIRFilter( ...
        'Numerator', [0 -6.62936356265794e-08 -2.62885043812295e-07 ...
        -5.86340783694262e-07 -1.03322582231793e-06 -1.60010003894645e-06 ...
        -2.28351454402821e-06 -3.08000782128528e-06 -3.98610170173869e-06 ...
        -4.99829717881281e-06 -6.11307007399194e-06 -7.32686656280171e-06 ...
        -8.6360985711828e-06 -1.0037139052612e-05 -1.15263171565728e-05 ...
        -1.30999132992476e-05 -1.47541541475174e-05 -1.64852075275841e-05 ...
        -1.82891772697273e-05 -2.0162098000889e-05 -2.20999298969524e-05 ...
        -2.40985534067205e-05 -2.61537639597444e-05 -2.82612666702532e-05 ...
        -3.04166710495405e-05 -3.26154857392398e-05 -3.48531132779728e-05 ...
        -3.71248449139072e-05 -3.94258554757702e-05 -4.17511983148751e-05 ...
        -4.40958003307006e-05 -4.64544570925246e-05 -4.88218280695642e-05 ...
        -5.11924319820014e-05 -5.35606422851782e-05 -5.59206827991407e-05 ...
        -5.82666234955779e-05 -6.05923764540566e-05 -6.2891691999285e-05 ...
        -6.51581550309585e-05 -6.73851815575309e-05 -6.95660154450437e-05 ...
        -7.16937253918986e-05 -7.37612021402113e-05 -7.57611559341071e-05 ...
        -7.76861142350314e-05 -7.95284197038429e-05 -8.1280228459135e-05 ...
        -8.29335086208952e-05 -8.44800391482546e-05 -8.59114089797189e-05 ...
        -8.72190164838855e-05 -8.83940692282546e-05 -8.9427584073337e-05 ...
        -9.03103875988345e-05 -9.1033116868235e-05 -9.15862205377176e-05 ...
        -9.19599603148047e-05 -9.21444127717289e-05 -9.21294715180015e-05 ...
        -9.19048497361822e-05 -9.14600830843508e-05 -9.07845329682751e-05 ...
        -8.9867390185756e-05 -8.86976789451075e-05 -8.72642612592036e-05 ...
        -8.55558417159913e-05 -8.35609726258298e-05 -8.12680595454708e-05 ...
        -7.86653671779555e-05 -7.57410256471474e-05 -7.24830371450736e-05 ...
        -6.88792829496948e-05 -6.4917530810167e-05 -6.05854426961081e-05 ...
        -5.58705829068324e-05 -5.07604265359569e-05 -4.52423682862459e-05 ...
        -3.93037316290046e-05 -3.29317783017969e-05 -2.6113718137723e-05 ...
        -1.88367192189593e-05 -1.10879183467422e-05 -2.85443181944797e-06 ...
        5.87663349008136e-06 1.51181687673255e-05 2.48830516088418e-05 ...
        3.51841341053265e-05 4.60342306657965e-05 5.74461055941766e-05 ...
        6.94324604300183e-05 8.20059210655315e-05 9.51790246515249e-05 ...
        0.00010896420630528 0.000123373785633776 0.00013841995308607 ...
        0.000154114756149008 0.000170470085400804 0.000187497660437358 ...
        0.000205209015686507 0.000223615486125706 0.000242728192918938 ...
        0.000262558028988894 0.000283115644540755 0.000304411432554084 ...
        0.00032645551425962 0.000349257724617884 0.000372827597816744 ...
        0.000397174352805185 0.000422306878880712 0.000448233721347872 ...
        0.000474963067265521 0.00050250273130049 0.000530860141705371 ...
        0.000560042326438172 0.000590055899441563 0.000620907047099467 ...
        0.000652601514888644 0.000685144594242919 0.000718541109647565 ...
        0.000752795405981265 0.000787911336122971 0.000823892248840768 ...
        0.00086074097697974 0.000898459825965587 0.000937050562640569 ...
        0.000976514404448066 0.00101685200898183 0.00105806346391569 ...
        0.00110014827732918 0.00114310536844423 0.00118693305878771 ...
        0.00123162906379434 0.00127719048486391 0.0013236138018865 ...
        0.00137089486624901 0.00141902889433566 0.00146801046153494 ...
        0.00151783349676469 0.00156849127752684 0.00161997642550261 ...
        0.00167228090269848 0.00172539600815275 0.00177931237521191 ...
        0.00183401996938555 0.00188950808678783 0.00194576535317304 ...
        0.00200277972357215 0.00206053848253662 0.00211902824499508 ...
        0.00217823495772793 0.00223814390146421 0.0022987396936044 ...
        0.00236000629157223 0.00242192699679789 0.00248448445933421 ...
        0.00254766068310696 0.00261143703179952 0.00267579423537147 ...
        0.00274071239721025 0.0028061710019138 0.00287214892370204 ...
        0.00293862443545385 0.00300557521836564 0.00307297837222713 ...
        0.00314081042630892 0.00320904735085602 0.00327766456918054 ...
        0.00334663697034649 0.0034159389224383 0.00348554428640486 ...
        0.00355542643046923 0.00362555824509439 0.00369591215849431 ...
        0.0037664601526788 0.00383717378002056 0.00390802418033163 ...
        0.00397898209843622 0.00405001790222605 0.00412110160118397 ...
        0.00419220286536089 0.00426329104479058 0.0043343351893263 ...
        0.00440530406888275 0.00447616619406634 0.0045468898371762 ...
        0.0046174430535579 0.0046877937032915 0.00475790947319503 ...
        0.00482775789912398 0.00489730638854719 0.00496652224337913 ...
        0.00503537268304788 0.00510382486777834 0.00517184592206932 ...
        0.00523940295834335 0.00530646310074746 0.005372993509083 ...
        0.00543896140284254 0.00550433408533144 0.00556907896785165 ...
        0.00563316359392512 0.00569655566353407 0.0057592230573553 ...
        0.00582113386096557 0.0058822563889952 0.00594255920920671 ...
        0.00600201116647571 0.00606058140665094 0.00611823940027062 ...
        0.00617495496611224 0.00623069829455309 0.00628543997071888 ...
        0.00633915099739806 0.00639180281769942 0.00644336733743121 ...
        0.00649381694717945 0.00654312454406434 0.00659126355315306 ...
        0.00663820794850814 0.00668393227385065 0.00672841166281779 ...
        0.00677162185879492 0.00681353923430258 0.00685414080991897 ...
        0.00689340427271948 0.00693130799421477 0.00696783104776961 ...
        0.00700295322548518 0.00703665505452796 0.00706891781288901 ...
        0.00709972354455778 0.00712905507409537 0.00715689602059269 ...
        0.00718323081099947 0.00720804469281074 0.00723132374609822 ...
        0.00725305489487434 0.00727322591777763 0.00729182545806862 ...
        0.00730884303292635 0.00732426904203596 0.00733809477545887 ...
        0.00735031242077753 0.00736091506950753 0.00736989672277073 ...
        0.00737725229622353 0.00738297762423545 0.00738706946331365 ...
        0.00738952549477013 0.00739034432662873 0.00738952549477013 ...
        0.00738706946331365 0.00738297762423545 0.00737725229622353 ...
        0.00736989672277073 0.00736091506950753 0.00735031242077753 ...
        0.00733809477545887 0.00732426904203596 0.00730884303292635 ...
        0.00729182545806862 0.00727322591777763 0.00725305489487434 ...
        0.00723132374609822 0.00720804469281074 0.00718323081099947 ...
        0.00715689602059269 0.00712905507409537 0.00709972354455778 ...
        0.00706891781288901 0.00703665505452796 0.00700295322548518 ...
        0.00696783104776961 0.00693130799421477 0.00689340427271948 ...
        0.00685414080991897 0.00681353923430258 0.00677162185879492 ...
        0.00672841166281779 0.00668393227385065 0.00663820794850814 ...
        0.00659126355315306 0.00654312454406434 0.00649381694717945 ...
        0.00644336733743121 0.00639180281769942 0.00633915099739806 ...
        0.00628543997071888 0.00623069829455309 0.00617495496611224 ...
        0.00611823940027062 0.00606058140665094 0.00600201116647571 ...
        0.00594255920920671 0.0058822563889952 0.00582113386096557 ...
        0.0057592230573553 0.00569655566353407 0.00563316359392512 ...
        0.00556907896785165 0.00550433408533144 0.00543896140284254 ...
        0.005372993509083 0.00530646310074746 0.00523940295834335 ...
        0.00517184592206932 0.00510382486777834 0.00503537268304788 ...
        0.00496652224337913 0.00489730638854719 0.00482775789912398 ...
        0.00475790947319503 0.0046877937032915 0.0046174430535579 ...
        0.0045468898371762 0.00447616619406634 0.00440530406888275 ...
        0.0043343351893263 0.00426329104479058 0.00419220286536089 ...
        0.00412110160118397 0.00405001790222605 0.00397898209843622 ...
        0.00390802418033163 0.00383717378002056 0.0037664601526788 ...
        0.00369591215849431 0.00362555824509439 0.00355542643046923 ...
        0.00348554428640486 0.0034159389224383 0.00334663697034649 ...
        0.00327766456918054 0.00320904735085602 0.00314081042630892 ...
        0.00307297837222713 0.00300557521836564 0.00293862443545385 ...
        0.00287214892370204 0.0028061710019138 0.00274071239721025 ...
        0.00267579423537147 0.00261143703179952 0.00254766068310696 ...
        0.00248448445933421 0.00242192699679789 0.00236000629157223 ...
        0.0022987396936044 0.00223814390146421 0.00217823495772793 ...
        0.00211902824499508 0.00206053848253662 0.00200277972357215 ...
        0.00194576535317304 0.00188950808678783 0.00183401996938555 ...
        0.00177931237521191 0.00172539600815275 0.00167228090269848 ...
        0.00161997642550261 0.00156849127752684 0.00151783349676469 ...
        0.00146801046153494 0.00141902889433566 0.00137089486624901 ...
        0.0013236138018865 0.00127719048486391 0.00123162906379434 ...
        0.00118693305878771 0.00114310536844423 0.00110014827732918 ...
        0.00105806346391569 0.00101685200898183 0.000976514404448066 ...
        0.000937050562640569 0.000898459825965587 0.00086074097697974 ...
        0.000823892248840768 0.000787911336122971 0.000752795405981265 ...
        0.000718541109647565 0.000685144594242919 0.000652601514888644 ...
        0.000620907047099467 0.000590055899441563 0.000560042326438172 ...
        0.000530860141705371 0.00050250273130049 0.000474963067265521 ...
        0.000448233721347872 0.000422306878880712 0.000397174352805185 ...
        0.000372827597816744 0.000349257724617884 0.00032645551425962 ...
        0.000304411432554084 0.000283115644540755 0.000262558028988894 ...
        0.000242728192918938 0.000223615486125706 0.000205209015686507 ...
        0.000187497660437358 0.000170470085400804 0.000154114756149008 ...
        0.00013841995308607 0.000123373785633776 0.00010896420630528 ...
        9.51790246515249e-05 8.20059210655315e-05 6.94324604300183e-05 ...
        5.74461055941766e-05 4.60342306657965e-05 3.51841341053265e-05 ...
        2.48830516088418e-05 1.51181687673255e-05 5.87663349008136e-06 ...
        -2.85443181944797e-06 -1.10879183467422e-05 -1.88367192189593e-05 ...
        -2.6113718137723e-05 -3.29317783017969e-05 -3.93037316290046e-05 ...
        -4.52423682862459e-05 -5.07604265359569e-05 -5.58705829068324e-05 ...
        -6.05854426961081e-05 -6.4917530810167e-05 -6.88792829496948e-05 ...
        -7.24830371450736e-05 -7.57410256471474e-05 -7.86653671779555e-05 ...
        -8.12680595454708e-05 -8.35609726258298e-05 -8.55558417159913e-05 ...
        -8.72642612592036e-05 -8.86976789451075e-05 -8.9867390185756e-05 ...
        -9.07845329682751e-05 -9.14600830843508e-05 -9.19048497361822e-05 ...
        -9.21294715180015e-05 -9.21444127717289e-05 -9.19599603148047e-05 ...
        -9.15862205377176e-05 -9.1033116868235e-05 -9.03103875988345e-05 ...
        -8.9427584073337e-05 -8.83940692282546e-05 -8.72190164838855e-05 ...
        -8.59114089797189e-05 -8.44800391482546e-05 -8.29335086208952e-05 ...
        -8.1280228459135e-05 -7.95284197038429e-05 -7.76861142350314e-05 ...
        -7.57611559341071e-05 -7.37612021402113e-05 -7.16937253918986e-05 ...
        -6.95660154450437e-05 -6.73851815575309e-05 -6.51581550309585e-05 ...
        -6.2891691999285e-05 -6.05923764540566e-05 -5.82666234955779e-05 ...
        -5.59206827991407e-05 -5.35606422851782e-05 -5.11924319820014e-05 ...
        -4.88218280695642e-05 -4.64544570925246e-05 -4.40958003307006e-05 ...
        -4.17511983148751e-05 -3.94258554757702e-05 -3.71248449139072e-05 ...
        -3.48531132779728e-05 -3.26154857392398e-05 -3.04166710495405e-05 ...
        -2.82612666702532e-05 -2.61537639597444e-05 -2.40985534067205e-05 ...
        -2.20999298969524e-05 -2.0162098000889e-05 -1.82891772697273e-05 ...
        -1.64852075275841e-05 -1.47541541475174e-05 -1.30999132992476e-05 ...
        -1.15263171565728e-05 -1.0037139052612e-05 -8.6360985711828e-06 ...
        -7.32686656280171e-06 -6.11307007399194e-06 -4.99829717881281e-06 ...
        -3.98610170173869e-06 -3.08000782128528e-06 -2.28351454402821e-06 ...
        -1.60010003894645e-06 -1.03322582231793e-06 -5.86340783694262e-07 ...
        -2.62885043812295e-07 -6.62936356265794e-08 0]);
end

y = step(Hd,x);


% [EOF]
